<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Order Success</title></head>
<body style="font-family:Inter,system-ui,Arial, sans-serif;padding:2rem;background:#f6f7fb">
  <main style="max-width:900px;margin:2rem auto;background:#fff;padding:2rem;border-radius:8px">
    <h1>Thank you — your payment is complete</h1>
    <p id="summary">Loading order details…</p>
    <div id="orderDetails"></div>
    <a href="index.html">Continue Shopping</a>
  </main>

  <script>
    (function(){
      function qs(name){ return new URLSearchParams(location.search).get(name); }
      const ref = qs('ref');
      const detailsEl = document.getElementById('orderDetails');
      const summaryEl = document.getElementById('summary');

      if (!ref){
        summaryEl.textContent = 'No reference found. If you completed a payment, please contact support with your email and name.';
        return;
      }

      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      const order = orders.find(o => o.paystackReference === ref);

      if (!order){
        summaryEl.textContent = 'Order not found locally. If you completed a payment, the server might have processed it. Please contact support and provide this reference: ' + ref;
        return;
      }

      summaryEl.textContent = `Order ${order.id} — Reference: ${order.paystackReference}`;
      detailsEl.innerHTML = `
        <p><strong>Name:</strong> ${order.name}</p>
        <p><strong>Email:</strong> ${order.email}</p>
        <p><strong>Total:</strong> ${order.total} ${order.currency || 'NGN'}</p>
        <h3>Items</h3>
        <ul>${order.items.map(i => `<li>${(i.name || 'Item')} — ${i.quantity || 1} × ${parseFloat(i.price).toFixed(2)}</li>`).join('')}</ul>
        <p><em>Recorded at: ${new Date(order.verifiedAt || order.createdAt).toLocaleString()}</em></p>
      `;
    })();
  </script>
</body>
</html>
